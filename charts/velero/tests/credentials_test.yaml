suite: Credentials
templates:
  - deployment.yaml
  - secret.yaml
tests:
  - it: doesn't create secrets or use them if there is no data or existing secret
    values:
      - base-values.yaml
    asserts:
      - template: secret.yaml
        hasDocuments:
          count: 0
      - template: deployment.yaml
        notContains:
          any: true
          path: spec.template.spec.volumes
          content:
            name: cloud-credentials
  - it: doesn't create secrets if an existingSecret is provided but does use them
    values:
      - base-values.yaml
    set:
      credentials:
        existingSecret: foo-secret
    asserts:
      - template: secret.yaml
        hasDocuments:
          count: 0
      - template: deployment.yaml
        contains:
          any: true
          path: spec.template.spec.volumes
          content:
            name: cloud-credentials
  - it: creates secrets and uses them if secretContent is provided
    values:
      - base-values.yaml
    set:
      credentials:
        existingSecretKey: credentials
        secretContents:
          credentials: |
            [default]
            aws_access_key_id=AKIAIOSFODNN7EXAMPLE
            aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
    asserts:
      - template: secret.yaml
        hasDocuments:
          count: 1
      - template: deployment.yaml
        contains:
          any: true
          path: spec.template.spec.volumes
          content:
            name: cloud-credentials
